# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License.

# Job Template: PostBuild steps

jobs:
- job: PostBuild
  displayName: PostBuild

  variables:
    Packaging.EnableSBOMSigning: true

  pool:
    name: VSEngSS-MicroBuild2019-1ES
    demands:
    - msbuild
    - vstest

  workspace:
    clean: outputs

  steps:
  - checkout: none

  - template: ../../steps/azuredevops/downloadbuildartifacts.yaml
    parameters:
      ArtifactName: binaries-windows-Release

  - template: ../../steps/microbuild/sbom.yaml

  - template: ../../steps/azuredevops/publishbuildartifacts.yaml
    parameters:
      PathToPublish: '$(Build.ArtifactStagingDirectory)\_manifest'
      ArtifactName: 'SBOM-manifest'

  - template: ../../steps/microbuild/cleanup.yaml